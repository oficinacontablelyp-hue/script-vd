-- GENERATOR BOOST DIAGNOSTIC TOOL (MOBILE VERSION - CORREGIDO)
-- Copia y pega TODO esto en un ejecutor en Mobile

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LP = Players.LocalPlayer

print("==========================================")
print("üîç GENERATOR BOOST DIAGNOSTIC TOOL (MOBILE)")
print("==========================================")

-- Crear interfaz para mobile
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BoostDiagnosticUI"
screenGui.Parent = game:GetService("CoreGui") or LP:WaitForChild("PlayerGui")

-- Funci√≥n para crear botones m√≥viles CORREGIDA
local function createMobileButton(text, position, size, callback)
    local button = Instance.new("TextButton")
    button.Name = text
    button.Text = text
    button.Position = position
    button.Size = size
    button.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    button.TextColor3 = Color3.new(1, 1, 1)  -- CORREGIDO: Color3.new en lugar de Color3.white
    button.Font = Enum.Font.GothamBold
    button.TextSize = 14
    button.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = button
    
    button.Activated:Connect(callback)
    return button
end

-- Funci√≥n para mostrar mensajes en pantalla (mobile-friendly)
local function showMobileMessage(title, message, duration)
    -- Notificaci√≥n del sistema
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title,
        Text = message,
        Duration = duration or 5
    })
    
    -- Tambi√©n mostrar en texto en pantalla para mobile
    local messageFrame = Instance.new("Frame")
    messageFrame.Name = "MobileMessage"
    messageFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    messageFrame.BackgroundTransparency = 0.3
    messageFrame.BorderSizePixel = 0
    messageFrame.Position = UDim2.new(0.5, -150, 0.1, 0)
    messageFrame.Size = UDim2.new(0, 300, 0, 80)
    messageFrame.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = messageFrame
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Text = "üì± " .. title
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Position = UDim2.new(0, 10, 0, 5)
    titleLabel.Size = UDim2.new(1, -20, 0, 25)
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 16
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = messageFrame
    
    local messageLabel = Instance.new("TextLabel")
    messageLabel.Text = message
    messageLabel.TextColor3 = Color3.new(1, 1, 1)  -- CORREGIDO
    messageLabel.BackgroundTransparency = 1
    messageLabel.Position = UDim2.new(0, 10, 0, 30)
    messageLabel.Size = UDim2.new(1, -20, 1, -35)
    messageLabel.Font = Enum.Font.Gotham
    messageLabel.TextSize = 14
    messageLabel.TextWrapped = true
    messageLabel.TextXAlignment = Enum.TextXAlignment.Left
    messageLabel.TextYAlignment = Enum.TextYAlignment.Top
    messageLabel.Parent = messageFrame
    
    -- Auto-eliminar despu√©s de un tiempo
    task.delay(duration or 5, function()
        if messageFrame and messageFrame.Parent then
            messageFrame:Destroy()
        end
    end)
    
    print("üì± " .. title .. ": " .. message)
end

-- Crear botones principales
local diagnosticBtn = createMobileButton("üîç Iniciar Diagn√≥stico", 
    UDim2.new(0.02, 0, 0.02, 0), 
    UDim2.new(0.3, 0, 0.06, 0),
    function()
        runFullDiagnostic()
    end)

local monitorBtn = createMobileButton("üìà Monitor en Vivo", 
    UDim2.new(0.34, 0, 0.02, 0), 
    UDim2.new(0.3, 0, 0.06, 0),
    function()
        startAttributeMonitor()
    end)

local stopBtn = createMobileButton("‚èπÔ∏è Detener", 
    UDim2.new(0.66, 0, 0.02, 0), 
    UDim2.new(0.3, 0, 0.06, 0),
    function()
        stopMonitoring = true
        showMobileMessage("Monitor Detenido", "El diagn√≥stico se ha detenido", 3)
    end)

-- Crear √°rea de texto para resultados
local resultsFrame = Instance.new("Frame")
resultsFrame.Name = "ResultsFrame"
resultsFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
resultsFrame.BackgroundTransparency = 0.2
resultsFrame.BorderSizePixel = 0
resultsFrame.Position = UDim2.new(0.02, 0, 0.1, 0)
resultsFrame.Size = UDim2.new(0.96, 0, 0.6, 0)
resultsFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = resultsFrame

local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Name = "ResultsScroll"
scrollFrame.BackgroundTransparency = 1
scrollFrame.Position = UDim2.new(0, 10, 0, 10)
scrollFrame.Size = UDim2.new(1, -20, 1, -20)
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollFrame.ScrollBarThickness = 6
scrollFrame.Parent = resultsFrame

local resultsLabel = Instance.new("TextLabel")
resultsLabel.Name = "ResultsText"
resultsLabel.Text = "üì± Generador Boost Diagnostic Tool\n\nPresiona 'Iniciar Diagn√≥stico' para comenzar"
resultsLabel.TextColor3 = Color3.new(1, 1, 1)  -- CORREGIDO
resultsLabel.BackgroundTransparency = 1
resultsLabel.Position = UDim2.new(0, 0, 0, 0)
resultsLabel.Size = UDim2.new(1, 0, 0, 0)
resultsLabel.Font = Enum.Font.Gotham
resultsLabel.TextSize = 14
resultsLabel.TextWrapped = true
resultsLabel.TextXAlignment = Enum.TextXAlignment.Left
resultsLabel.TextYAlignment = Enum.TextYAlignment.Top
resultsLabel.Parent = scrollFrame

-- Funci√≥n para agregar texto a los resultados
local function addToResults(text)
    resultsLabel.Text = resultsLabel.Text .. "\n" .. text
    
    -- Ajustar tama√±o del label
    local textHeight = 20 + (string.len(text) / 40) * 14
    resultsLabel.Size = UDim2.new(1, 0, 0, resultsLabel.TextBounds.Y + 10)
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, resultsLabel.TextBounds.Y + 20)
    
    -- Auto-scroll al final
    task.wait()
    scrollFrame.CanvasPosition = Vector2.new(0, resultsLabel.TextBounds.Y)
end

-- Funci√≥n para limpiar resultados
local function clearResults()
    resultsLabel.Text = "üì± Generador Boost Diagnostic Tool\n"
    scrollFrame.CanvasPosition = Vector2.new(0, 0)
end

-- Buscar generadores en el mapa
local function findGenerators()
    addToResults("\nüîé BUSCANDO GENERADORES...")
    local generators = {}
    
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and (obj.Name:lower():find("generator") or obj.Name:lower():find("gen")) then
            table.insert(generators, obj)
            addToResults("   ‚úÖ Encontrado: " .. obj.Name)
        end
    end
    
    if #generators == 0 then
        addToResults("   ‚ùå No se encontraron generadores")
    else
        addToResults("   üìä Total encontrados: " .. #generators)
    end
    
    return generators
end

-- Analizar atributos de un objeto
local function analyzeAttributes(obj, objName)
    local attributes = obj:GetAttributes()
    
    if #attributes > 0 then
        addToResults("\nüìä ATRIBUTOS DE " .. objName .. " (" .. #attributes .. "):")
        
        for _, attr in ipairs(attributes) do
            local value = obj:GetAttribute(attr)
            local attrLower = attr:lower()
            
            -- Resaltar atributos interesantes
            if attrLower:find("boost") or 
               attrLower:find("multiplier") or 
               attrLower:find("speed") or
               attrLower:find("repair") or
               attrLower:find("coop") or
               attrLower:find("team") then
                
                addToResults("   ‚≠ê " .. attr .. " = " .. tostring(value) .. " (RELEVANTE!)")
            else
                addToResults("   ‚Ä¢ " .. attr .. " = " .. tostring(value))
            end
        end
        return true
    else
        addToResults("   ‚ùå Sin atributos")
        return false
    end
end

-- Monitor de atributos en tiempo real
local stopMonitoring = false
local monitorConnection = nil

local function startAttributeMonitor()
    clearResults()
    addToResults("üìà MONITOR EN TIEMPO REAL ACTIVADO")
    addToResults("Repara un generador para ver cambios...")
    addToResults("Presiona 'Detener' cuando termines")
    
    stopMonitoring = false
    showMobileMessage("Monitor Activado", "Repara generadores para ver cambios\nToca 'Detener' para parar", 4)
    
    local lastValues = {}
    
    if monitorConnection then
        monitorConnection:Disconnect()
    end
    
    monitorConnection = RunService.Heartbeat:Connect(function()
        if stopMonitoring then
            monitorConnection:Disconnect()
            addToResults("\n‚èπÔ∏è Monitor detenido")
            return
        end
        
        -- Monitorear atributos del jugador
        local playerAttrs = LP:GetAttributes()
        for _, attr in ipairs(playerAttrs) do
            local currentValue = LP:GetAttribute(attr)
            local lastValue = lastValues["player_" .. attr]
            
            if lastValue == nil then
                lastValues["player_" .. attr] = currentValue
            elseif currentValue ~= lastValue then
                local changeText = "üîÑ CAMBIO en jugador: " .. attr .. " = " .. lastValue .. " ‚Üí " .. currentValue
                addToResults(changeText)
                showMobileMessage("¬°Cambio Detectado!", attr .. ": " .. lastValue .. " ‚Üí " .. currentValue, 3)
                lastValues["player_" .. attr] = currentValue
            end
        end
    end)
end

-- Buscar RemoteEvents/Functions relacionados
local function findRelatedRemotes()
    addToResults("\nüîå BUSCANDO REMOTES RELACIONADOS...")
    
    local foundRemotes = {}
    
    for _, obj in ipairs(ReplicatedStorage:GetDescendants()) do
        local name = obj.Name:lower()
        
        if (obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction")) and
           (name:find("boost") or 
            name:find("repair") or 
            name:find("generator") or
            name:find("coop") or
            name:find("team") or
            name:find("speed")) then
            
            table.insert(foundRemotes, obj.Name)
            addToResults("   üì° " .. obj.Name .. " (" .. obj.ClassName .. ")")
        end
    end
    
    if #foundRemotes == 0 then
        addToResults("   ‚ùå No se encontraron remotes relevantes")
    else
        addToResults("   üìä Total remotes: " .. #foundRemotes)
    end
end

-- Analizar scripts del juego
local function analyzeGameScripts()
    addToResults("\nüìú BUSCANDO SCRIPTS RELEVANTES...")
    
    local searchTerms = {"repair", "boost", "generator", "coop", "team", "speed"}
    local foundScripts = {}
    
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Script") or obj:IsA("LocalScript") or obj:IsA("ModuleScript") then
            local scriptName = obj.Name:lower()
            
            for _, term in ipairs(searchTerms) do
                if scriptName:find(term) then
                    if not foundScripts[obj.Name] then
                        foundScripts[obj.Name] = true
                        addToResults("   üìÑ " .. obj.Name .. " (" .. obj.ClassName .. ")")
                    end
                end
            end
        end
    end
end

-- Funci√≥n principal de diagn√≥stico
local function runFullDiagnostic()
    clearResults()
    
    addToResults("üöÄ DIAGN√ìSTICO COMPLETO INICIADO")
    addToResults("==================================")
    
    showMobileMessage("Diagn√≥stico", "Iniciando an√°lisis completo...", 3)
    
    -- 1. Analizar jugador
    addToResults("\n1Ô∏è‚É£ ANALIZANDO JUGADOR LOCAL:")
    analyzeAttributes(LP, "JUGADOR")
    
    -- 2. Buscar generadores
    local generators = findGenerators()
    if #generators > 0 then
        addToResults("\n2Ô∏è‚É£ ANALIZANDO PRIMER GENERADOR ENCONTRADO:")
        analyzeAttributes(generators[1], generators[1].Name)
    end
    
    -- 3. Buscar remotes
    findRelatedRemotes()
    
    -- 4. Buscar scripts
    analyzeGameScripts()
    
    -- 5. Mostrar resumen
    addToResults("\nüìã RESUMEN DEL DIAGN√ìSTICO:")
    addToResults("==================================")
    
    addToResults("\nüéØ INSTRUCCIONES PARA MOBILE:")
    addToResults("1. Ve a reparar un generador SOLO")
    addToResults("2. Luego repara CON OTRO SURVIVOR")
    addToResults("3. Mira los cambios en esta pantalla")
    addToResults("4. Anota el atributo que aumenta")
    
    addToResults("\nüîç ATRIBUTOS A BUSCAR:")
    addToResults("‚Ä¢ RepairBoost")
    addToResults("‚Ä¢ GeneratorMultiplier") 
    addToResults("‚Ä¢ CoOpRepairSpeed")
    addToResults("‚Ä¢ TeamRepairBonus")
    addToResults("‚Ä¢ RepairSpeedMultiplier")
    
    addToResults("\nüí° CONSEJO MOBILE:")
    addToResults("Si ves un n√∫mero que aumenta")
    addToResults("(ej: 1.0 ‚Üí 1.05)")
    addToResults("¬°Ese es el atributo que buscas!")
    
    showMobileMessage("Diagn√≥stico Completo", "Empieza a reparar generadores\nMira los cambios en pantalla", 5)
    
    -- Bot√≥n para iniciar monitor autom√°ticamente
    task.wait(2)
    createMobileButton("‚ñ∂Ô∏è Iniciar Monitor Ahora",
        UDim2.new(0.02, 0, 0.72, 0),
        UDim2.new(0.96, 0, 0.06, 0),
        function()
            startAttributeMonitor()
        end)
end

-- Instrucciones iniciales
showMobileMessage("Generador Boost Diagnostic", 
    "Herramienta cargada correctamente\nToca los botones para diagnosticar", 5)

addToResults("üì± GENERATOR BOOST DIAGNOSTIC TOOL")
addToResults("Versi√≥n Mobile")
addToResults("================================")
addToResults("\nüéÆ CONTROLES:")
addToResults("‚Ä¢ üîç Iniciar Diagn√≥stico - An√°lisis completo")
addToResults("‚Ä¢ üìà Monitor en Vivo - Ver cambios en tiempo real")
addToResults("‚Ä¢ ‚èπÔ∏è Detener - Parar el monitor")
addToResults("\nüìù INSTRUCCIONES:")
addToResults("1. Toca 'Iniciar Diagn√≥stico'")
addToResults("2. Repara generadores normalmente")
addToResults("3. Observa los cambios en pantalla")
addToResults("4. Anota el atributo que aumenta")

-- Funci√≥n para limpiar cuando se cierra
game:GetService("CoreGui").ChildRemoved:Connect(function(child)
    if child.Name == "BoostDiagnosticUI" then
        if monitorConnection then
            monitorConnection:Disconnect()
        end
    end
end)

-- Notificaci√≥n de carga completa
print("‚úÖ GENERATOR BOOST DIAGNOSTIC (MOBILE) CARGADO")
print("üì± Interfaz creada en pantalla")

-- Hacer que las funciones sean globales para los botones
_G.runFullDiagnostic = runFullDiagnostic
_G.startAttributeMonitor = startAttributeMonitor
